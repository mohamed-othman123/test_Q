<h2>{{ 'purchases.attachments' | translate }}</h2>
<div class="wrapper">
  @if (!isViewMode) {
    <form (ngSubmit)="addOrUpdate()" appShakeable [formGroup]="attachmentForm">
      <app-input
        class="attachment-name"
        [control]="attachmentForm.controls.name"
        [controlName]="'name'"
        [label]="'purchases.attachmentName' | translate"
        [placeholder]="'purchases.attachmentName' | translate">
        <i class="pi pi-file" style="color: gray"></i>
      </app-input>
      @if (!editAttachmentMode) {
        <app-file-upload
          [accept]="acceptedFileTypes"
          [disabled]="editAttachmentMode"
          [control]="attachmentForm.controls.file"
          [hint]="'purchases.attachmentHint' | translate"
          [title]="'purchases.addAttachment' | translate">
        </app-file-upload>
      }
      @if (editedAttachmentIndex === null) {
        <p-button
          label="{{ 'purchases.addAttachment' | translate }}"
          type="submit"
        [icon]="'pi pi-plus'"></p-button>
      }
      @if (editedAttachmentIndex !== null) {
        <div class="edit-actions">
          <p-button
            label="{{ 'common.update' | translate }}"
            type="submit"
          [icon]="'pi pi-pencil'"></p-button>
          <p-button
            severity="secondary"
            (onClick)="cancelEdit()"
            label="{{ 'common.cancel' | translate }}"
            type="button"
          [icon]="'pi pi-times'"></p-button>
        </div>
      }
    </form>
  }

  @if (selectedAttachments.length > 0) {
    <h5>
      {{ 'purchases.selectedAttachments' | translate }}
    </h5>
  }
  <p-table
    [paginator]="selectedAttachments.length > 5"
    [rows]="5"
    [rowsPerPageOptions]="[5, 10, 25]"
    [totalRecords]="selectedAttachments.length"
    [value]="selectedAttachments"
    [tableStyle]="{'min-width': '50rem'}">
    <ng-template pTemplate="header">
      @if (selectedAttachments.length > 0) {
        <tr>
          <th>{{ 'purchases.attachmentName' | translate }}</th>
          <th style="width: fit-content"></th>
        </tr>
      }
    </ng-template>
    <ng-template pTemplate="body" let-attachment let-rowIndex="rowIndex">
      <tr>
        <td>{{ attachment.name }}</td>
        <td>
          <div class="actions">
            <div
              (click)="openAttachment(attachment)"
              class="action-button open">
              <i class="pi pi-external-link"></i>
              <span>{{ 'common.preview' | translate }}</span>
            </div>
            @if (!isViewMode) {
              <div
                (click)="editAttachment(attachment, rowIndex)"
                class="action-button edit">
                <i class="pi pi-pencil"></i>
                <span>{{ 'common.edit' | translate }}</span>
              </div>
              <div
                appConfirmDeleteDialog
                [deletedItem]="'purchases.attachment' | translate"
                (acceptDelete)="deleteAttachment(rowIndex)"
                class="action-button delete">
                <i class="pi pi-trash"></i>
                <span>{{ 'common.delete' | translate }}</span>
              </div>
            }
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <app-empty-state
          [customMessage]="
            'purchases.noAttachments' | translate
          "></app-empty-state>
      </tr>
    </ng-template>
  </p-table>

  <!-- actions -->
  <div class="form-actions">
    <button
      (click)="previousStep(0)"
      type="button"
      pButton
      class="p-button-secondary"
      [label]="'common.previous' | translate">
      <i
        [ngClass]="
          lang.lang === 'ar' ? 'pi pi-arrow-right' : 'pi pi-arrow-left'
        "></i>
    </button>
    @if (hasPermissionToEdit()) {
      <button
        type="button"
        pButton
        icon="pi pi-pencil"
        (click)="switchToEdit()">
        {{ 'common.edit' | translate }}
      </button>
    } @else if (!isViewMode) {
      <button
        type="button"
        pButton
        icon="pi pi-save"
        (click)="submitPurchases()">
        {{ 'common.save' | translate }}
      </button>
    }
  </div>
</div>

<div class="form-section">
  <div class="row">
    @for (item of itemsArray.controls; track item; let i = $index) {
      <div class="d-flex flex-wrap gap-2 mb-4 align-items-end">
        <!--type-->
        <div class="col-md-2 col-12">
          <app-dropdown
            [label]="'purchases.supplierItemType' | translate"
            [control]="$any(item.get('type'))"
            [controlName]="'type'"
            [optionValue]="'value'"
            [options]="(itemsType$ | async) || []"
            [optionLabel]="lang.lang === 'ar' ? 'label.ar' : 'label.en'"
            [placeholder]="'purchases.selectSupplierItemType' | translate"
            class="me-2"
            (onChange)="clearItemValues(i, false)">
          </app-dropdown>
        </div>
        <!--name-->
        <div class="col-md-3 col-12">
          <app-input
            [control]="$any(item.get('name'))"
            controlName="name"
            [label]="
              item.get('type')?.value === 'service'
                ? ('purchases.supplierService' | translate)
                : ('purchases.supplierProduct' | translate)
            "
            [placeholder]="
              item.get('type')?.value === 'service'
                ? ('purchases.enterSupplierService' | translate)
                : ('purchases.enterSupplierProduct' | translate)
            "
            [showClear]="true"
            (onClear)="clearItemValues(i, false)">
          </app-input>
        </div>
        <div class="col-md-2 col-12">
          <app-input
            (onChange)="onPriceChange()"
            [control]="$any(item.get('value'))"
            controlName="value"
            inputType="number"
            [label]="'purchases.price' | translate"
            [placeholder]="'purchases.enterPrice' | translate"
            [disabled]="item.get('id')?.value">
          </app-input>
        </div>
        <div class="col-md-2 col-12">
          <app-input
            [control]="$any(item.get('quantity'))"
            controlName="quantity"
            type="number"
            [label]="'purchases.quantity' | translate"
            [placeholder]="'purchases.enterQuantity' | translate"
            (onChange)="onQuantityChange()">
          </app-input>
        </div>
        <div class="d-flex align-items-end col-md-2 col-5">
          <app-input
            [disabled]="true"
            [control]="$any(item.get('total'))"
            controlName="total"
            type="number"
            [label]="'purchases.total' | translate">
          </app-input>
          <span class="price-with-symbol">
            <sar-symbol />
          </span>
        </div>
        <div class="d-flex align-items-end gap-2">
          @if (i !== 0) {
            <div
              appConfirmDeleteDialog
              [deletedItem]="
                item.get('type')?.value === 'service'
                  ? ('purchases.service' | translate)
                  : ('purchases.product' | translate)
              "
              (acceptDelete)="removeItem(i)"
              class="action-button delete">
              <i style="color: red; font-size: 1.5rem" class="pi pi-trash"></i>
            </div>
          }
        </div>
        @if (item.hasError('duplicate')) {
          <div class="col-md-3 error-text">
            <img src="/assets/icons/exclamation.icon.svg" alt="error" />
            <span> {{ 'purchases.duplicate' | translate }}</span>
          </div>
        }
      </div>
    }
    @if (itemsArray.hasError('duplicateItems') && itemsArray.touched) {
      <div class="error-text">
        {{ 'purchases.duplicateItems' | translate }}
      </div>
    }
    <!--add new item btn-->
    <button
      class="apply-btn mt-2"
      type="button"
      pButton
      icon="pi pi-plus"
      [label]="'purchases.addNewItem' | translate"
      (click)="addNewItem()"></button>
  </div>
</div>

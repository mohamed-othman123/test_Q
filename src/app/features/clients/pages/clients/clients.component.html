<app-list-header
  [btnAddText]="'clients.addNewClient' | translate"
  [disableAddBtn]="!permissionsService.hasPermission('create:hallsClients')"
  [title]="'sideNav.clients' | translate"
  (sideDrawerToggler)="addNewClient()"></app-list-header>

<p-table
  #dt2
  [value]="clients"
  dataKey="id"
  [rows]="rows"
  selectionMode="multiple"
  [(selection)]="selectedItems"
  [rowsPerPageOptions]="rowsPerPageOptions"
  [totalRecords]="totalRecords"
  [first]="first"
  [paginator]="true"
  [lazy]="true"
  (onLazyLoad)="onLazyLoad($event)">
  <ng-template pTemplate="header">
    <tr>
      <th></th>
      <th pSortableColumn="name">
        {{ 'clients.clientName' | translate }}
        <p-sortIcon field="name" class="mr-12px"></p-sortIcon>
      </th>

      <th pSortableColumn="phone">
        {{ 'clients.mobileNo' | translate }}
        <p-sortIcon field="phone" class="mr-12px"></p-sortIcon>
      </th>
      <th pSortableColumn="email">
        {{ 'clients.email' | translate }}
        <p-sortIcon field="email" class="mr-12px"></p-sortIcon>
      </th>
      <th>
        {{ 'clients.type' | translate }}
      </th>
      <th>
        {{ 'common.linkedAccount' | translate }}
      </th>
      <th style="width: fit-content"></th>
    </tr>
    <tr>
      <th style="width: 20px"></th>
      <th>
        <app-input
          [control]="filterForm.get('name')!"
          [controlName]="'name'"
          inputType="text"
          [showLabel]="false"
          [placeholder]="'common.search' | translate">
          <i class="pi pi-search" style="color: #667085"></i>
        </app-input>
      </th>

      <th>
        <app-input
          [control]="filterForm.get('phone')!"
          [controlName]="'phone'"
          inputType="text"
          [showLabel]="false"
          [placeholder]="'common.search' | translate">
          <i class="pi pi-search" style="color: #667085"></i>
        </app-input>
      </th>
      <th>
        <app-input
          [control]="filterForm.get('email')!"
          [controlName]="'email'"
          inputType="text"
          [showLabel]="false"
          [placeholder]="'common.search' | translate">
          <i class="pi pi-search" style="color: #667085"></i>
        </app-input>
      </th>
      <th>
        <app-dropdown
          appendTo="body"
          [control]="filterForm.get('type')!"
          [options]="clientTypes"
          [controlName]="'type'"
          [optionLabel]="'label.' + translate.currentLang"
          [optionValue]="'value'"
          [placeholder]="'clients.selectClientType' | translate"
          [showClear]="true">
        </app-dropdown>
      </th>
      <th></th>
      <th></th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-client>
    <tr>
      <td>
        <div style="width: fit-content"></div>
      </td>
      <td>
        {{ client.name }}
        @if (client?.isVIB) {
          <img width="35px" src="/assets/icons/vip-icon.svg" alt="Vip" />
        }
      </td>

      <td dir="ltr" class="text-center">
        <a
          href="https://wa.me/{{ client.phone }}"
          target="_blank"
          (click)="$event.stopPropagation()"
          class="whatsapp-link">
          <span>{{ client.phone }}</span>
          <i class="pi pi-whatsapp text-green-500"></i>
        </a>
      </td>
      <td>
        <a
          href="mailto:{{ client.email }}"
          (click)="$event.stopPropagation()"
          class="hover:underline text-blue-600">
          {{ client.email }}
        </a>
      </td>
      <td>
        {{ 'clients.' + client.type | translate }}
      </td>
      <td>
        {{
          lang.lang === 'ar' ? client.account?.name_ar : client.account?.name
        }}
        - {{ client.account?.accountCode }}
      </td>
      <td>
        <div class="actions">
          @if (hasPermissionTo('view', client)) {
            <div (click)="viewClient(client)" class="action-button">
              <i class="pi pi-eye"></i>
              <span>{{ 'common.view' | translate }}</span>
            </div>
          }
          @if (hasPermissionTo('update', client)) {
            <div (click)="editClient($event, client)" class="action-button">
              <i class="pi pi-file-edit"></i>
              <span>{{ 'common.edit' | translate }}</span>
            </div>
          }
          @if (hasPermissionTo('delete', client)) {
            <div
              appConfirmDeleteDialog
              [deletedItem]="'clients.client' | translate"
              (acceptDelete)="confirmDeleteClient(client)"
              class="action-button delete">
              <i class="pi pi-trash"></i>
              <span>{{ 'common.delete' | translate }}</span>
            </div>
          }
        </div>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="6">
        <app-empty-state></app-empty-state>
      </td>
    </tr>
  </ng-template>
</p-table>

<app-add-new-client
  (refreshDataTable)="refreshDataTable()"></app-add-new-client>

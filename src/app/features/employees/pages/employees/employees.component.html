<app-list-header
  [btnAddText]="'employees.addNewEmployee' | translate"
  [title]="'sideNav.employees' | translate"
  (sideDrawerToggler)="addNewModerator()"></app-list-header>

<p-table
  #dt2
  [value]="Moderators"
  dataKey="id"
  [rows]="rows"
  [lazy]="true"
  selectionMode="multiple"
  [(selection)]="selectedItems"
  [rowsPerPageOptions]="rowsPerPageOptions"
  [totalRecords]="totalRecords"
  [first]="first"
  [paginator]="true"
  (onLazyLoad)="onLazyLoad($event)">
  <ng-template pTemplate="header">
    <tr>
      <th pSortableColumn="name">
        {{ 'employees.employeeName' | translate }}
        <p-sortIcon field="name" class="mr-12px"></p-sortIcon>
      </th>
      <th pSortableColumn="role">
        {{ 'employees.job' | translate }}
        <p-sortIcon field="role" class="mr-12px"></p-sortIcon>
      </th>
      <th pSortableColumn="email">
        {{ 'employees.email' | translate }}
        <p-sortIcon field="email" class="mr-12px"></p-sortIcon>
      </th>
      <th pSortableColumn="phone">
        {{ 'employees.employeePhone' | translate }}
        <p-sortIcon field="phone" class="mr-12px"></p-sortIcon>
      </th>
      <th pSortableColumn="created_at">
        {{ 'employees.addDate' | translate }}
        <p-sortIcon field="created_at" class="mr-12px"></p-sortIcon>
      </th>
      <th pSortableColumn="active">
        {{ 'employees.status' | translate }}
        <p-sortIcon field="active" class="mr-12px"></p-sortIcon>
      </th>
      <th style="width: fit-content"></th>
    </tr>
    <tr>
      <th>
        <app-input
          [control]="filterForm.get('name')!"
          [controlName]="'name'"
          inputType="text"
          [showLabel]="false"
          [placeholder]="'common.search' | translate">
          <i class="pi pi-search" style="color: gray"></i>
        </app-input>
      </th>
      <th>
        <app-input
          [control]="filterForm.get('role')!"
          [controlName]="'role'"
          inputType="text"
          [showLabel]="false"
          [placeholder]="'common.search' | translate">
          <i class="pi pi-search" style="color: gray"></i>
        </app-input>
      </th>
      <th>
        <app-input
          [control]="filterForm.get('email')!"
          [controlName]="'email'"
          inputType="text"
          [showLabel]="false"
          [placeholder]="'common.search' | translate">
          <i class="pi pi-search" style="color: gray"></i>
        </app-input>
      </th>
      <th>
        <app-input
          [control]="filterForm.get('phone')!"
          [controlName]="'phone'"
          inputType="text"
          [showLabel]="false"
          [placeholder]="'common.search' | translate">
          <i class="pi pi-search" style="color: gray"></i>
        </app-input>
      </th>
      <th style="min-width: 200px">
        <app-gregorian-date-picker
          [control]="$any(filterForm.get('creationDate'))"
          controlName="creationDate"
          [showClear]="true"
          [placeholder]="'common.search' | translate">
        </app-gregorian-date-picker>
      </th>
      <th>
        <app-dropdown
          appendTo="body"
          [control]="filterForm.get('active')!"
          [options]="employeeStatuses"
          [controlName]="'active'"
          [optionLabel]="'label.' + translate.currentLang"
          [optionValue]="'value'"
          [placeholder]="'employees.selectEmployeeStatus' | translate"
          [showClear]="true">
        </app-dropdown>
      </th>
      <th></th>
      <th></th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-employee>
    <tr (click)="viewDetails(employee)">
      <td>
        {{ employee.name }}
      </td>
      <td>
        {{ lang.lang === 'ar' ? employee.role.name_ar : employee.role.name }}
      </td>
      <td>
        {{ employee.email }}
      </td>
      <td dir="ltr" class="text-center">
        <a
          href="https://wa.me/{{ employee.phone }}"
          target="_blank"
          (click)="$event.stopPropagation()"
          class="whatsapp-link">
          <span>{{ employee.phone }}</span>
          <i class="pi pi-whatsapp text-green-500"></i>
        </a>
      </td>
      <td>
        {{
          lang.lang === 'ar'
            ? (employee.created_at | arabicMonthDate)
            : (employee.created_at | englishMonthDate)
        }}
      </td>
      <td>
        {{
          (employee.active ? 'employees.active' : 'employees.notActive')
            | translate
        }}
      </td>
      <td>
        <div class="actions">
          <div (click)="editModerator($event, employee)" class="action-button">
            <i class="pi pi-file-edit"></i>
            <span>{{ 'common.edit' | translate }}</span>
          </div>
          <div
            appConfirmDeleteDialog
            [deletedItem]="'employees.employee' | translate"
            (acceptDelete)="deleteEmployee(employee)"
            class="action-button delete">
            <i class="pi pi-trash"></i>
            <span>{{ 'common.delete' | translate }}</span>
          </div>
        </div>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="7">
        <app-empty-state></app-empty-state>
      </td>
    </tr>
  </ng-template>
</p-table>

<app-add-new-employee
  (refreshDataTable)="refreshDataTable()"></app-add-new-employee>

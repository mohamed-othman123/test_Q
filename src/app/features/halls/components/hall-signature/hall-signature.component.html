<div>
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h5 class="mb-3">
      {{ 'halls.hallSignatureAndStamp' | translate }}
    </h5>
    <div class="actions">
      <button id="details-save-btn" (click)="submit()" class="action-button">
        <i class="pi pi-save me-2"></i>
        {{ 'halls.saveDetails' | translate }}
      </button>
    </div>
  </div>

  <!--signatureName-->
  <div>
    <div class="col-md-6 mb-3">
      <app-input
        [control]="$any(signatureForm.get('signatureName'))"
        [controlName]="'signatureName'"
        inputType="text"
        [label]="'halls.firstPartyName' | translate"
        [placeholder]="'halls.firstPartyNamePlaceholder' | translate">
      </app-input>
    </div>

    <!--stamp section-->
    <div class="d-flex align-items-start gap-3 mb-4">
      <div class="stamp-section">
        <h6 class="stamp-section-title">
          <i class="pi pi-image me-2"></i>
          {{ 'halls.stamp' | translate }}
        </h6>
        <div class="stamp-uploader">
          <div class="stamp-preview" [class.has-stamp]="stampUrl">
            @if (stampUrl) {
              <img
                class="stamp-image"
                [src]="stampUrl"
                crossorigin="anonymous"
                alt="Hall stamp"
                [class.has-transparency]="" />
            }

            @if (!stampUrl) {
              <div class="empty-stamp">
                <i class="pi pi-image"></i>
                <div class="empty-stamp-text">
                  {{ 'halls.noStampUploaded' | translate }}
                </div>
              </div>
            }

            <div class="stamp-controls">
              <div class="upload-btn">
                <input
                  #fileInput
                  (change)="onChangeStamp($any($event.target).files)"
                  accept="image/*"
                  class="file-input"
                  type="file" />
                <button
                  (click)="fileInput.click()"
                  class="btn btn-upload"
                  type="button">
                  <i class="pi pi-camera"></i>
                  {{
                    stampUrl
                      ? ('halls.changeStamp' | translate)
                      : ('halls.submitStamp' | translate)
                  }}
                </button>
              </div>

              @if (stampUrl) {
                <button
                  type="button"
                  class="btn btn-delete"
                  appConfirmDeleteDialog
                  [deletedItem]="'halls.stamp' | translate"
                  (acceptDelete)="deleteStamp()">
                  <i class="pi pi-trash"></i>
                  {{ 'common.delete' | translate }}
                </button>
              }
            </div>
          </div>
        </div>
      </div>

      <!--signature pad -->
      <div>
        <app-signature-pad
          [width]="100"
          [penColor]="'blue'"
          [label]="''"
          [existingSignatureData]="signatureUrl"
          [instructions]="'halls.signatureInstructions' | translate"
          (signatureChange)="signatureChange($event)"
          (signatureCleared)="clearSignature()">
        </app-signature-pad>
      </div>
    </div>
  </div>
</div>
<!--signature table-->
<div class="signature-table">
  <h5 class="text-primary mb-3">
    {{ 'halls.signatureSetting' | translate }}
  </h5>
  <form [formGroup]="signatureForm" class="signature-form">
    <ng-container formArrayName="documentsArray">
      <p-table dataKey="id" [value]="documentsArray.controls">
        <ng-template pTemplate="header">
          <tr style="border-bottom: 1px solid #dad9d9">
            <th style="background-color: #f5f5f5; padding: 20px">
              {{ 'halls.contractsAndBillsType' | translate }}
            </th>
            <th style="background-color: #f5f5f5">
              {{ 'halls.firstParty' | translate }}
            </th>
            <th style="background-color: #f5f5f5">
              {{ 'halls.firstPartyStamp' | translate }}
            </th>
            <th style="background-color: #f5f5f5">
              {{ 'halls.secondParty' | translate }}
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-document let-i="rowIndex">
          <tr [formGroupName]="i">
            <td style="background-color: #f5f5f5">
              <strong>{{
                lang.lang === 'ar'
                  ? document.get('name_ar').value
                  : document.get('name').value
              }}</strong>
            </td>
            <td>
              <p-checkbox formControlName="firstPartySignature" [binary]="true">
              </p-checkbox>
            </td>
            <td>
              <p-checkbox formControlName="firstPartyStamp" [binary]="true">
              </p-checkbox>
            </td>
            <td>
              <p-checkbox
                formControlName="secondPartySignature"
                [binary]="true">
              </p-checkbox>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="4" class="text-center p-4">
              <app-empty-state
                [customMessage]="
                  'halls.noSignatures' | translate
                "></app-empty-state>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </ng-container>
  </form>
</div>

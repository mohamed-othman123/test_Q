<h2>{{ 'halls.attachments' | translate }}</h2>
<div class="d-flex align-items-center gap-3">
  <div>
    <strong> {{ 'halls.eventType' | translate }} : </strong>
    {{
    lang.lang === 'ar'
    ? editedContract?.event?.name_ar
    : editedContract?.event?.name
    }}
  </div>
  <div>
    <strong> {{ 'halls.clientType' | translate }} : </strong>
    {{ 'halls.' + editedContract?.customerType | translate }}
  </div>
</div>
<div class="wrapper">
  <form (ngSubmit)="addOrUpdate()" appShakeable [formGroup]="attachmentForm">
    <app-input
      class="attachment-name"
      [control]="attachmentForm.controls.name"
      [controlName]="'name'"
      [label]="'halls.attachmentName' | translate"
      [placeholder]="'halls.attachmentName' | translate">
      <i class="pi pi-file" style="color: gray"></i>
    </app-input>
    @if (!editAttachmentMode) {
      <app-file-upload
        [accept]="'application/pdf'"
        [disabled]="editAttachmentMode"
        [control]="attachmentForm.controls.file"
        [hint]="'halls.attachmentHint' | translate"
        [title]="'halls.addAttachment' | translate">
      </app-file-upload>
    }
    @if (editedAttachmentId === null) {
      <p-button
        label="{{ 'halls.addAttachment' | translate }}"
        type="submit"
      [icon]="'pi pi-plus'"></p-button>
    }
    @if (editedAttachmentId !== null) {
      <div class="edit-actions">
        <p-button
          label="{{ 'common.update' | translate }}"
          type="submit"
        [icon]="'pi pi-pencil'"></p-button>
        <p-button
          severity="secondary"
          (onClick)="cancelEdit()"
          label="{{ 'common.cancel' | translate }}"
          type="button"
        [icon]="'pi pi-times'"></p-button>
      </div>
    }
  </form>

  @if (attachments.length > 0) {
    <h5>
      {{ 'halls.selectedAttachments' | translate }}
    </h5>
  }
  <p-table
    [paginator]="attachments.length > 5"
    [rows]="5"
    [rowsPerPageOptions]="[5, 10, 25]"
    [totalRecords]="attachments.length"
    [value]="attachments"
    [tableStyle]="{'min-width': '50rem'}">
    <ng-template pTemplate="header">
      @if (attachments.length > 0) {
        <tr>
          <th>{{ 'halls.attachmentName' | translate }}</th>
          <th style="width: fit-content"></th>
        </tr>
      }
    </ng-template>
    <ng-template pTemplate="body" let-attachment let-rowIndex="rowIndex">
      <tr>
        <td>{{ attachment.name }}</td>
        <td>
          <div class="actions">
            <div
              (click)="openAttachment(attachment)"
              class="action-button open">
              <i class="pi pi-external-link"></i>
              <span>{{ 'common.preview' | translate }}</span>
            </div>

            <div
              (click)="editAttachment(attachment)"
              class="action-button edit">
              <i class="pi pi-pencil"></i>
              <span>{{ 'common.edit' | translate }}</span>
            </div>
            <div
              appConfirmDeleteDialog
              [deletedItem]="'halls.attachment' | translate"
              (acceptDelete)="deleteAttachment(attachment)"
              class="action-button delete">
              <i class="pi pi-trash"></i>
              <span>{{ 'common.delete' | translate }}</span>
            </div>
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <app-empty-state
        [customMessage]="'halls.noAttachments' | translate"></app-empty-state>
      </tr>
    </ng-template>
  </p-table>
</div>

<div>
  <div class="actions">
    <div class="action-button delete" (click)="cancel()">
      @if (lang.lang === 'ar') {
        <i class="pi pi-chevron-right"></i>
      } @else {
        <i class="pi pi-chevron-left"></i>
      }

      {{ 'halls.goBackToContracts' | translate }}
    </div>
  </div>
</div>

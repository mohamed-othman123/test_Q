<app-list-header
  [btnAddText]="'suppliers.addNewSupplier' | translate"
  [disableAddBtn]="!permissionsService.hasPermission('create:suppliers')"
  [title]="'sideNav.suppliers' | translate"
  (sideDrawerToggler)="addNewSupplier()">
</app-list-header>

@if (suppliers) {
  <p-table
    #dt
    [value]="suppliers"
    dataKey="id"
    [rows]="rows"
    [first]="first"
    [rowsPerPageOptions]="rowsPerPageOptions"
    [totalRecords]="totalRecords"
    [paginator]="true"
    [lazy]="true"
    (onLazyLoad)="onLazyLoad($event)"
    [globalFilterFields]="['name', 'phone', 'status', 'activity']">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="name">
          {{ 'suppliers.supplierName' | translate }}
          <p-sortIcon field="name" class="mr-12px"></p-sortIcon>
        </th>
        <th pSortableColumn="phone">
          {{ 'suppliers.phoneNumber' | translate }}
          <p-sortIcon field="phone" class="mr-12px"></p-sortIcon>
        </th>
        <th pSortableColumn="active">
          {{ 'suppliers.supplierStatus' | translate }}
          <p-sortIcon field="active" class="mr-12px"></p-sortIcon>
        </th>
        <th pSortableColumn="activity">
          {{ 'suppliers.activity' | translate }}
          <p-sortIcon field="activity" class="mr-12px"></p-sortIcon>
        </th>
        <th style="width: fit-content"></th>
      </tr>
      <tr>
        <th>
          <app-input
            [control]="filterForm.get('name')!"
            [controlName]="'name'"
            inputType="text"
            [showLabel]="false"
            [placeholder]="'common.search' | translate">
            <i class="pi pi-search" style="color: #667085"></i>
          </app-input>
        </th>
        <th>
          <app-input
            [control]="filterForm.get('phone')!"
            [controlName]="'phone'"
            inputType="text"
            [showLabel]="false"
            [placeholder]="'common.search' | translate">
            <i class="pi pi-search" style="color: #667085"></i>
          </app-input>
        </th>
        <th>
          <app-dropdown
            appendTo="body"
            [control]="filterForm.get('active')!"
            [options]="supplierStatuses"
            [controlName]="'active'"
            [optionLabel]="'label.' + translate.currentLang"
            [optionValue]="'value'"
            [placeholder]="'suppliers.selectStatus' | translate"
            [showClear]="true">
            <i class="pi pi-search" style="color: #667085"></i>
          </app-dropdown>
        </th>
        <th>
          <app-input
            [control]="filterForm.get('activity')!"
            [controlName]="'activity'"
            inputType="text"
            [showLabel]="false"
            [placeholder]="'common.search' | translate">
            <i class="pi pi-search" style="color: #667085"></i>
          </app-input>
        </th>
        <th></th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-supplier>
      <tr>
        <td class="text-wrap">{{ supplier.name }}</td>
        <td dir="ltr" class="text-center">
          <a
            href="https://wa.me/{{ supplier.phone }}"
            target="_blank"
            (click)="$event.stopPropagation()"
            class="whatsapp-link">
            <span>{{ supplier.phone }}</span>
            <i class="pi pi-whatsapp text-green-500"></i>
          </a>
        </td>
        <td>
          {{
            supplier.active
              ? ('suppliers.active' | translate)
              : ('suppliers.inactive' | translate)
          }}
        </td>
        <td>{{ supplier.activity }}</td>
        <td>
          <div ngbDropdown container="body" class="d-inline-block">
            <button
              type="button"
              class="options-button"
              id="dropdownBasic1"
              ngbDropdownToggle>
              <span
                class="p-button-icon p-button-icon-left pi pi-ellipsis-v"></span>
              {{ 'common.options' | translate }}
            </button>
            <div
              ngbDropdownMenu
              aria-labelledby="dropdownBasic1"
              class="p-menu p-menu-overlay">
              @if (hasPermissionTo('update', supplier)) {
                <button
                  ngbDropdownItem
                  (click)="editSupplier(supplier)"
                  class="d-flex gap-3">
                  <i class="pi pi-pencil"></i>
                  <span>{{ 'common.edit' | translate }}</span>
                </button>
              }
              @if (hasPermissionTo('view', supplier)) {
                <button
                  ngbDropdownItem
                  (click)="viewSupplier(supplier)"
                  class="d-flex gap-3">
                  <i class="pi pi-eye"></i>
                  <span>{{ 'common.view' | translate }}</span>
                </button>
              }
              @if (hasPermissionTo('delete', supplier)) {
                <button
                  ngbDropdownItem
                  class="d-flex gap-3"
                  (click)="openDeleteConfirmation(supplier.id)">
                  <i class="pi pi-times-circle"></i>
                  <span>{{ 'common.delete' | translate }}</span>
                </button>
              }
            </div>
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5">
          <app-empty-state></app-empty-state>
        </td>
      </tr>
    </ng-template>
  </p-table>
}

<app-confirm-popup
  [visible]="showDeleteConfirmation"
  [message]="getDeleteMessage()"
  (confirm)="confirmDeleteSupplier()"
  (reject)="rejectDeleteSupplier()"></app-confirm-popup>

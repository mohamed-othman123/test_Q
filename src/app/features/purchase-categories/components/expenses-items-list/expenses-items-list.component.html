<app-list-header
  [btnAddText]="'expensesItems.addNewItem' | translate"
  [disableAddBtn]="!permissionService.hasPermission('create:expenseItem')"
  [title]="'sideNav.expensesItems' | translate"
  (sideDrawerToggler)="addNewExpenseItem()"></app-list-header>

<div class="px-3">
  <p-messages severity="success">
    <ng-template pTemplate>
      <div class="d-flex align-items-center gap-2">
        <i class="pi pi-info-circle"> </i>
        {{ 'expensesItems.description' | translate }}
      </div>
    </ng-template>
  </p-messages>
</div>

<p-table
  #dt2
  [value]="expensesItems"
  dataKey="id"
  [rows]="rows"
  selectionMode="multiple"
  [rowsPerPageOptions]="rowsPerPageOptions"
  [paginator]="true"
  [totalRecords]="totalRecords"
  [first]="first"
  (onLazyLoad)="onLazyLoad($event)"
  [lazy]="true">
  <ng-template pTemplate="header">
    <tr>
      <th></th>

      <th pSortableColumn="item">
        {{ 'expensesItems.itemName' | translate }}
        <p-sortIcon field="item" class="mr-12px"></p-sortIcon>
      </th>

      <th style="width: fit-content"></th>
    </tr>
    <tr>
      <th style="width: 20px"></th>

      <th>
        <app-input
          [control]="$any(filterForm.get('item'))"
          [controlName]="'item'"
          inputType="text"
          [placeholder]="'common.search' | translate">
        </app-input>
      </th>

      <th style="width: fit-content"></th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-expenseItem>
    <tr>
      <td>
        <div style="width: fit-content"></div>
      </td>

      <td class="text-wrap">
        {{ lang.lang === 'ar' ? expenseItem.nameAr : expenseItem.name }}
      </td>

      <td>
        <div ngbDropdown container="body" class="d-inline-block">
          <button
            type="button"
            class="options-button"
            id="dropdownBasic1"
            ngbDropdownToggle>
            <span
              class="p-button-icon p-button-icon-left pi pi-ellipsis-v"></span>
            {{ 'common.options' | translate }}
          </button>
          <div
            ngbDropdownMenu
            aria-labelledby="dropdownBasic1"
            class="p-menu p-menu-overlay">
            @if (hasPermissionTo('update', expenseItem)) {
              <button
                ngbDropdownItem
                (click)="updateExpenseItem(expenseItem.id)"
                class="d-flex gap-3">
                <i class="pi pi-pencil"></i>
                <span>{{ 'common.edit' | translate }}</span>
              </button>
            }
            @if (hasPermissionTo('read', expenseItem)) {
              <button
                ngbDropdownItem
                (click)="viewExpenseItem(expenseItem.id)"
                class="d-flex gap-3">
                <i class="pi pi-eye"></i>
                <span>{{ 'common.view' | translate }}</span>
              </button>
            }
            @if (hasPermissionTo('delete', expenseItem)) {
              <button
                ngbDropdownItem
                class="d-flex gap-3"
                (click)="openDeleteConfirmation(expenseItem.id)">
                <i class="pi pi-times-circle"></i>
                <span>{{ 'common.delete' | translate }}</span>
              </button>
            }
          </div>
        </div>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="5">
        <app-empty-state></app-empty-state>
      </td>
    </tr>
  </ng-template>
</p-table>

<!-- Delete Confirmation Dialog -->
<app-confirm-popup
  [visible]="showDeleteConfirmation"
  [message]="'expensesItems.deleteItemMessage' | translate"
  (confirm)="confirmDeleteExpenseItem()"
  (reject)="rejectDeleteExpenseItem()"></app-confirm-popup>

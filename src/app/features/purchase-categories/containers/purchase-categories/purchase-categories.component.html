<app-list-header
  [btnAddText]="'categories.addNewCategory' | translate"
  [disableAddBtn]="!permissionsService.hasPermission('create:expense category')"
  [title]="'sideNav.expensesCategory' | translate"
  (sideDrawerToggler)="openPurchaseCategoryForm('add')"></app-list-header>

<p-table
  #dt2
  [value]="categories"
  dataKey="id"
  [rows]="rows"
  [lazy]="true"
  selectionMode="multiple"
  [totalRecords]="totalRecords"
  [rowsPerPageOptions]="rowsPerPageOptions"
  [first]="first"
  [paginator]="true"
  (onLazyLoad)="onLazyLoad($event)">
  <ng-template pTemplate="header">
    <tr>
      <th>
        {{ 'purchases.expenseType' | translate }}
      </th>

      <th pSortableColumn="name">
        {{ 'categories.expenseCategory' | translate }}
        <p-sortIcon field="name" class="mr-12px" />
      </th>
      <th pSortableColumn="description">
        {{ 'categories.expenseDescription' | translate }}
        <p-sortIcon field="description" class="mr-12px" />
      </th>

      <th></th>
      <th style="width: fit-content"></th>
    </tr>
    <tr>
      <th>
        <app-dropdown
          appendTo="body"
          [control]="$any(filterForm.get('type'))"
          [options]="expenseType"
          [controlName]="'type'"
          [optionLabel]="'label.' + translate.currentLang"
          [optionValue]="'value'"
          [placeholder]="'purchases.expenseType' | translate"
          [showClear]="true">
        </app-dropdown>
      </th>
      <th>
        <app-input
          [control]="filterForm.get('name')!"
          [controlName]="'name'"
          inputType="text"
          [showLabel]="false"
          [placeholder]="'common.search' | translate">
          <i class="pi pi-search" style="color: #667085"></i>
        </app-input>
      </th>
      <th>
        <app-input
          [control]="filterForm.get('description')!"
          [controlName]="'description'"
          inputType="text"
          [showLabel]="false"
          [placeholder]="'common.search' | translate">
          <i class="pi pi-search" style="color: #667085"></i>
        </app-input>
      </th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-category>
    <tr>
      <td>
        {{
          category.type === 'Purchases'
            ? ('purchases.purchasesExpenses' | translate)
            : ('purchases.generalExpenses' | translate)
        }}
      </td>

      <td style="text-wrap: auto">
        {{
          translate.currentLang === 'ar' && category?.name_ar
            ? category?.name_ar
            : category?.name
        }}
      </td>

      <td style="text-wrap: auto">
        {{ category.description }}
      </td>

      <td>
        <div class="actions">
          <div ngbDropdown container="body" class="d-inline-block">
            <button
              type="button"
              class="options-button"
              id="dropdownBasic1"
              ngbDropdownToggle>
              <span
                class="p-button-icon p-button-icon-left pi pi-ellipsis-v"></span>
              {{ 'common.options' | translate }}
            </button>
            <div
              ngbDropdownMenu
              aria-labelledby="dropdownBasic1"
              class="p-menu p-menu-overlay">
              @if (hasPermissionTo('edit', category)) {
                <button
                  ngbDropdownItem
                  (click)="openPurchaseCategoryForm('edit', $event, category)"
                  class="d-flex gap-3">
                  <i class="pi pi-pencil"></i>
                  <span>{{ 'common.edit' | translate }}</span>
                </button>
              }

              <button
                ngbDropdownItem
                (click)="view(category)"
                class="d-flex gap-3">
                <i class="pi pi-eye"></i>
                <span>{{ 'common.view' | translate }}</span>
              </button>

              @if (category.type !== 'Purchases') {
                <button
                  ngbDropdownItem
                  (click)="addExpenseItem(category)"
                  class="d-flex gap-3">
                  <i class="pi pi-plus"></i>
                  <span>{{ 'categories.addExpenseItem' | translate }}</span>
                </button>
              }

              @if (hasPermissionTo('delete', category)) {
                <button
                  (click)="openDeleteConfirmation(category.id)"
                  ngbDropdownItem
                  class="d-flex gap-3">
                  <i class="pi pi-times-circle"></i>
                  <span>{{ 'common.delete' | translate }}</span>
                </button>
              }
            </div>
          </div>
        </div>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="5">
        <app-empty-state></app-empty-state>
      </td>
    </tr>
  </ng-template>
</p-table>

<purchase-categories-form
  (refreshDataTable)="refreshDataTable()"></purchase-categories-form>

<app-confirm-delete-popup
  [visible]="showDeleteConfirmation"
  [message]="'categories.deleteCategory' | translate"
  (confirm)="confirmDeleteCategory()"
  (reject)="rejectDeleteCategory()"></app-confirm-delete-popup>

<div class="enhanced-sections">
  <div class="section-header">
    <h4>{{ 'landing.websiteSections' | translate }}</h4>
    <p class="header-description">
      {{ 'landing.sectionsDescription' | translate }}
    </p>
  </div>

  @if (getEnabledSections().length > 0) {
    <div class="enabled-sections">
      <h5 class="subsection-title">
        <i class="pi pi-check-circle"></i>
        {{ 'landing.activeSections' | translate }}
      </h5>
      <div
        class="section-list"
        cdkDropList
        [cdkDropListData]="getEnabledSections()"
        (cdkDropListDropped)="onDrop($event)">
        @for (template of getEnabledSections(); track template) {
          <div class="section-card enabled" cdkDrag [cdkDragData]="template">
            <div class="drag-handle" cdkDragHandle>
              <i class="pi pi-bars"></i>
            </div>
            <div class="card-header">
              <div class="section-info">
                <div class="section-icon">
                  <i [class]="template.icon"></i>
                </div>
                <div class="section-details">
                  <h6>
                    {{
                      lang.lang === 'ar' ? template.label.ar : template.label.en
                    }}
                  </h6>
                  <p>
                    {{
                      lang.lang === 'ar'
                        ? template.description.ar
                        : template.description.en
                    }}
                  </p>
                </div>
              </div>
              <div class="section-actions">
                <div class="order-badge">{{ template.order }}</div>
                <button
                  type="button"
                  class="action-btn expand-btn"
                  [class.active]="template.isExpanded"
                  (click)="onSectionExpand(template)"
                  [title]="
                    template.isExpanded
                      ? ('common.collapse' | translate)
                      : ('common.expand' | translate)
                  ">
                  <i
                    class="pi"
                    [class.pi-chevron-up]="template.isExpanded"
                    [class.pi-chevron-down]="!template.isExpanded"></i>
                </button>
                <p-inputSwitch
                  [(ngModel)]="template.isEnabled"
                  (ngModelChange)="onSectionToggle(template, $event)"
                  [disabled]="isLoading">
                </p-inputSwitch>
              </div>
            </div>
            @if (template.isExpanded) {
              <div class="card-content" [class.expanded]="template.isExpanded">
                @if (!template.isEditing && template.data) {
                  <div class="content-header">
                    <div class="section-preview">
                      @if (template.data.title_en || template.data.title_ar) {
                        <div class="preview-item">
                          <strong>{{ 'common.title' | translate }}:</strong>
                          <span>{{
                            lang.lang === 'ar'
                              ? template.data.title_ar
                              : template.data.title_en
                          }}</span>
                        </div>
                      }
                      @if (
                        template.data.description_en ||
                        template.data.description_ar
                      ) {
                        <div class="preview-item">
                          <strong
                            >{{ 'common.description' | translate }}:</strong
                          >
                          <span>{{
                            lang.lang === 'ar'
                              ? template.data.description_ar
                              : template.data.description_en
                          }}</span>
                        </div>
                      }
                    </div>
                    <button
                      type="button"
                      class="edit-btn"
                      (click)="onSectionEdit(template)">
                      <i class="pi pi-pencil"></i>
                      {{ 'common.edit' | translate }}
                    </button>
                  </div>
                }
                @if (template.isEditing) {
                  <form
                    [formGroup]="template.form!"
                    class="section-form"
                    (ngSubmit)="onSectionSave(template)">
                    <div class="form-grid">
                      <div class="form-group">
                        <label
                          >{{ 'landing.sectionTitle' | translate }} (EN)</label
                        >
                        <input
                          type="text"
                          pInputText
                          formControlName="title_en"
                          [placeholder]="
                            'landing.sectionTitlePlaceholder' | translate
                          " />
                      </div>
                      <div class="form-group">
                        <label
                          >{{
                            'landing.sectionTitleAr' | translate
                          }}
                          (AR)</label
                        >
                        <input
                          type="text"
                          pInputText
                          formControlName="title_ar"
                          [placeholder]="
                            'landing.sectionTitleArPlaceholder' | translate
                          " />
                      </div>
                      <div class="form-group full-width">
                        <label
                          >{{ 'landing.sectionDescription' | translate }} (EN)
                          ({{ 'common.optional' | translate }})</label
                        >
                        <textarea
                          pInputTextarea
                          formControlName="description_en"
                          [placeholder]="
                            'landing.sectionDescriptionPlaceholder' | translate
                          "
                          rows="3">
                        </textarea>
                      </div>
                      <div class="form-group full-width">
                        <label
                          >{{ 'landing.sectionDescriptionAr' | translate }} (AR)
                          ({{ 'common.optional' | translate }})</label
                        >
                        <textarea
                          pInputTextarea
                          formControlName="description_ar"
                          [placeholder]="
                            'landing.sectionDescriptionArPlaceholder'
                              | translate
                          "
                          rows="3">
                        </textarea>
                      </div>
                    </div>
                    <div class="form-actions">
                      <button
                        type="button"
                        pButton
                        class="p-button-secondary"
                        icon="pi pi-times"
                        [label]="'common.cancel' | translate"
                        (click)="onSectionCancel(template)"></button>
                      <button
                        type="submit"
                        pButton
                        icon="pi pi-check"
                        [label]="'common.save' | translate"
                        [loading]="isLoading"
                        [disabled]="!template.form?.valid"></button>
                    </div>
                  </form>
                }
              </div>
            }
          </div>
        }
      </div>
    </div>
  }

  <div class="disabled-sections">
    <h5 class="subsection-title">
      <i class="pi pi-circle"></i>
      {{ 'landing.availableSections' | translate }}
    </h5>

    <div class="section-grid">
      @for (template of getDisabledSections(); track template) {
        <div class="section-card disabled">
          <div class="card-header">
            <div class="section-info">
              <div class="section-icon">
                <i [class]="template.icon"></i>
              </div>
              <div class="section-details">
                <h6>
                  {{
                    lang.lang === 'ar' ? template.label.ar : template.label.en
                  }}
                </h6>
                <p>
                  {{
                    lang.lang === 'ar'
                      ? template.description.ar
                      : template.description.en
                  }}
                </p>
              </div>
            </div>
            <div class="section-actions">
              <p-inputSwitch
                [(ngModel)]="template.isEnabled"
                (ngModelChange)="onSectionToggle(template, $event)"
                [disabled]="isLoading">
              </p-inputSwitch>
            </div>
          </div>
        </div>
      }
    </div>
  </div>

  @if (getEnabledSections().length === 0) {
    <div class="empty-state">
      <div class="empty-content">
        <i class="pi pi-list"></i>
        <h5>{{ 'landing.noActiveSections' | translate }}</h5>
        <p>{{ 'landing.noActiveSectionsDescription' | translate }}</p>
      </div>
    </div>
  }
</div>

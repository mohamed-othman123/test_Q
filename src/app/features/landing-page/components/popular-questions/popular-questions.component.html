@if (landingPageData?.id) {
  <div class="questions-section">
    <div class="section-header">
      <h4>{{ 'landing.popularQuestions' | translate }}</h4>
      <div class="header-actions">
        @if (!isEditMode && questions.length > 0) {
          <button type="button" class="edit-button" (click)="toggleEditMode()">
            <i class="pi pi-pencil"></i>
            {{ 'common.edit' | translate }}
          </button>
        }
        @if (!isEditMode && questions.length === 0) {
          <button type="button" class="add-button" (click)="addQuestion()">
            <i class="pi pi-plus"></i>
            {{ 'landing.addQuestion' | translate }}
          </button>
        }
        @if (isEditMode) {
          <button
            type="button"
            class="add-button"
            (click)="addQuestion()"
            [disabled]="questions.length >= maxQuestions || hasEmptyQuestion()">
            <i class="pi pi-plus"></i>
            {{ 'landing.addQuestion' | translate }}
          </button>
        }
      </div>
    </div>
    <!-- Empty State -->
    @if (questions.length < 1 && !isEditMode) {
      <app-empty-data
        icon="pi pi-question-circle"
        [title]="'landing.noQuestions'"
        [description]="'landing.addFirstQuestion'"
        [disabled]="questions.length >= maxQuestions"></app-empty-data>
    }
    <div
      class="questions-list"
      cdkDropList
      (cdkDropListDropped)="onDrop($event)"
      [cdkDropListDisabled]="!isEditMode">
      @for (
        questionGroup of questions.controls;
        track questionGroup;
        let i = $index
      ) {
        <div class="question-item" cdkDrag [formGroup]="$any(questionGroup)">
          <!-- View Mode -->
          @if (!isEditMode) {
            <div class="question-content">
              <div
                class="question-header"
                (click)="toggleQuestion(i)"
                [class.expanded]="expandedQuestions.has(i)">
                <span class="question-number">{{ i + 1 }}</span>
                <h5>{{ questionGroup.get('question')?.value }}</h5>
                <i
                  class="pi"
                  [ngClass]="{
                    'pi-chevron-down': !expandedQuestions.has(i),
                    'pi-chevron-up': expandedQuestions.has(i),
                  }"></i>
              </div>
              @if (expandedQuestions.has(i)) {
                <div class="answer-content">
                  <div
                    [innerHTML]="
                      getSafeHtml(questionGroup.get('answer')?.value)
                    "></div>
                </div>
              }
            </div>
          }
          <!-- Edit Mode -->
          @if (isEditMode) {
            <div class="question-content edit">
              <div
                class="question-edit-header"
                (click)="toggleQuestion(i)"
                [class.expanded]="expandedQuestions.has(i)">
                <div
                  class="drag-handle"
                  cdkDragHandle
                  (click)="$event.stopPropagation()">
                  <i class="pi pi-bars"></i>
                </div>
                <span class="question-number">{{ i + 1 }}</span>
                <div class="question-title">
                  {{
                    questionGroup.get('question')?.value ||
                      'landing.newQuestion' | translate
                  }}
                </div>
                <button
                  type="button"
                  class="remove-button"
                  (click)="removeQuestion(i); $event.stopPropagation()">
                  <i class="pi pi-trash"></i>
                </button>
                <i
                  class="pi"
                  [ngClass]="{
                    'pi-chevron-down': !expandedQuestions.has(i),
                    'pi-chevron-up': expandedQuestions.has(i),
                  }"></i>
              </div>
              @if (expandedQuestions.has(i)) {
                <div class="question-edit-form">
                  <app-input
                    [control]="questionGroup.get('question')!"
                    [controlName]="'question'"
                    [inputType]="'text'"
                    [label]="'landing.question' | translate"
                    [placeholder]="'landing.questionPlaceholder' | translate">
                  </app-input>
                  <app-rich-text-editor
                    [isSimple]="true"
                    [formControl]="$any(questionGroup.get('answer'))"
                    [placeholder]="'landing.answerPlaceholder' | translate"
                    [label]="'landing.answer' | translate"
                    [required]="true"
                    [disabled]="false">
                  </app-rich-text-editor>
                </div>
              }
            </div>
          }
        </div>
      }
    </div>
    <!-- Action Buttons -->
    @if (isEditMode) {
      <div class="form-actions">
        <button
          type="button"
          pButton
          class="p-button-secondary"
          [label]="'common.cancel' | translate"
          icon="pi pi-times"
          (click)="cancelEdit()"></button>
        <button
          type="button"
          pButton
          icon="pi pi-save"
          [label]="'common.save' | translate"
          (click)="saveQuestions()"
          [disabled]="questions.invalid || isSaving"></button>
      </div>
    }
  </div>
}

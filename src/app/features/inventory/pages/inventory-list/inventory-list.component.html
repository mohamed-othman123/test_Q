<app-list-header
  [btnAddText]="'inventory.addNewItem' | translate"
  [disableAddBtn]="!permissionsService.hasPermission('create:inventory')"
  [title]="'sideNav.inventory' | translate"
  (sideDrawerToggler)="addNewItem()"></app-list-header>

<p-table
  #dt2
  [scrollable]="true"
  [value]="inventoryList"
  dataKey="id"
  [rows]="rows"
  [lazy]="true"
  [totalRecords]="totalRecords"
  [rowsPerPageOptions]="rowsPerPageOptions"
  [first]="first"
  [paginator]="true"
  (onLazyLoad)="onLazyLoad($event)">
  <ng-template pTemplate="header">
    <tr>
      <th pSortableColumn="name">
        {{ 'inventory.itemName' | translate }}
        <p-sortIcon field="name" class="mr-12px" />
      </th>
      <!-- <th pSortableColumn="unitPrice">
        {{ 'inventory.unitPrice' | translate }}
        <p-sortIcon field="unitPrice" class="mr-12px" />
      </th> -->
      <th pSortableColumn="quantity">
        {{ 'inventory.quantity' | translate }}
        <p-sortIcon field="quantity" class="mr-12px" />
      </th>
      <th pSortableColumn="reorderLevel">
        {{ 'inventory.reorderLevel' | translate }}
        <p-sortIcon field="reorderLevel" class="mr-12px" />
      </th>
      <th pSortableColumn="created_at">
        {{ 'inventory.creationDate' | translate }}
        <p-sortIcon field="created_at" class="mr-12px" />
      </th>
      <th pSortableColumn="updated_at">
        {{ 'inventory.updatedDate' | translate }}
        <p-sortIcon field="updated_at" class="mr-12px" />
      </th>
    </tr>
    <tr>
      <th>
        <app-input
          [control]="filterForm.get('name')!"
          [controlName]="'name'"
          inputType="text"
          [showLabel]="false"
          [placeholder]="'common.search' | translate">
          <i class="pi pi-search" style="color: #667085"></i>
        </app-input>
      </th>
      <!-- <th>
        <app-input
          [control]="filterForm.get('unitPrice')!"
          [controlName]="'unitPrice'"
          inputType="number"
          [showLabel]="false"
          [placeholder]="'common.search' | translate">
          <i class="pi pi-search" style="color: #667085"></i>
        </app-input>
      </th> -->
      <th>
        <app-input
          [control]="filterForm.get('quantity')!"
          [controlName]="'quantity'"
          inputType="number"
          [showLabel]="false"
          [placeholder]="'common.search' | translate">
          <i class="pi pi-search" style="color: #667085"></i>
        </app-input>
      </th>

      <th>
        <app-input
          [control]="filterForm.get('reorderLevel')!"
          [controlName]="'reorderLevel'"
          inputType="number"
          [showLabel]="false"
          [placeholder]="'common.search' | translate">
          <i class="pi pi-search" style="color: #667085"></i>
        </app-input>
      </th>

      <th style="min-width: 180px">
        <app-gregorian-date-picker
          [control]="$any(filterForm.get('creationDate'))"
          controlName="creationDate"
          [showClear]="true"
          [placeholder]="'common.selectDate' | translate">
        </app-gregorian-date-picker>
      </th>

      <th style="min-width: 180px">
        <app-gregorian-date-picker
          [control]="$any(filterForm.get('updatedDate'))"
          controlName="updatedDate"
          [showClear]="true"
          [placeholder]="'common.selectDate' | translate">
        </app-gregorian-date-picker>
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-item>
    <tr>
      <td>
        {{ lang.lang === 'en' ? item.name : item.name_ar }}
      </td>
      <!-- <td>
        <span class="price-with-symbol">
          <sar-symbol />
          {{ item.unitPrice }}
        </span>
      </td> -->
      <td>
        {{ item.totalQuantity }}
      </td>
      <td>
        {{ item.reorderLevel }}
      </td>
      <td>
        @if (lang.lang === 'en') {
          {{
            item.created_at | englishMonthDate: false : 'DD-MM-YYYY' : 'short'
          }}
        }
        @if (lang.lang === 'ar') {
          {{
            item.created_at | arabicMonthDate: false : 'DD-MM-YYYY' : 'short'
          }}
        }
      </td>

      <td>
        @if (lang.lang === 'en') {
          {{ item.updated_at | englishMonthDate: false : 'DD-MM-YYYY' }}
        }
        @if (lang.lang === 'ar') {
          {{ item.updated_at | arabicMonthDate: false : 'DD-MM-YYYY' }}
        }
      </td>

      <td
        class="d-flex gap-2 align-items-center justify-content-between options-col actions">
        <div ngbDropdown container="body" class="d-inline-block">
          <button
            type="button"
            class="options-button"
            id="dropdownBasic1"
            ngbDropdownToggle>
            <span
              class="p-button-icon p-button-icon-left pi pi-ellipsis-v"></span>
            {{ 'common.options' | translate }}
          </button>
          <div
            ngbDropdownMenu
            aria-labelledby="dropdownBasic1"
            class="p-menu p-menu-overlay">
            <!-- Payment -->

            @if (hasPermissionTo('update', item)) {
              <button
                ngbDropdownItem
                (click)="editItem(item)"
                class="d-flex gap-3">
                <i class="pi pi-pencil"></i>
                <span>{{ 'common.edit' | translate }}</span>
              </button>
            }

            <button
              ngbDropdownItem
              (click)="viewItem(item)"
              class="d-flex gap-3">
              <i class="pi pi-eye"></i>
              <span>{{ 'common.view' | translate }}</span>
            </button>

            @if (hasPermissionTo('delete', item)) {
              <button
                ngbDropdownItem
                class="d-flex gap-3"
                (click)="openDeleteConfirmation(item.id)">
                <i class="pi pi-times-circle"></i>
                <span>{{ 'common.cancel' | translate }}</span>
              </button>
            }
          </div>
        </div>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="8">
        <app-empty-state></app-empty-state>
      </td>
    </tr>
  </ng-template>
</p-table>

<!--add notes when delete-->
<p-dialog
  [header]="'inventory.deleteConfirmation' | translate"
  [modal]="true"
  [dismissableMask]="true"
  [(visible)]="showDeleteReasonPopup"
  [style]="{'max-width': '90%'}"
  [draggable]="false"
  [resizable]="true">
  <div class="rejection-note-dialog">
    <div class="px-3">
      <p-messages severity="warn">
        <ng-template pTemplate>
          <div class="d-flex align-items-center gap-2">
            <i class="pi pi-info-circle"> </i>
            {{ 'inventory.deleteItemMessage' | translate }}
          </div>
        </ng-template>
      </p-messages>
    </div>

    <div style="min-width: 350px">
      <app-input
        [control]="deleteReason"
        [controlName]="'rejectionNote'"
        inputType="textarea"
        [rowsNo]="5"
        [label]="'inventory.deleteReason' | translate"
        [placeholder]="'inventory.deleteReason' | translate">
        <i class="pi pi-comment" style="color: #667085"></i>
      </app-input>
    </div>

    <div class="d-flex justify-content-end mt-3 gap-5">
      <button
        pButton
        severity="secondary"
        type="button"
        label="{{ 'common.cancel' | translate }}"
        (click)="showDeleteReasonPopup = false"
        class="p-button-text"></button>
      <button
        pButton
        type="button"
        label="{{ 'common.save' | translate }}"
        (click)="confirmDeleteItem()"
        class="p-button-primary"></button>
    </div>
  </div>
</p-dialog>

@if (paymentDetails) {
  <div class="mb-4">
    <info-tooltip
      [createdBy]="paymentDetails.created_by"
      [createdAt]="paymentDetails.created_at"
      [updatedBy]="paymentDetails.updated_by"
      [updatedAt]="paymentDetails.updated_at">
    </info-tooltip>
  </div>
}

<!-- Payment Information Section -->
<h5>{{ 'payment.paymentDetails' | translate }}</h5>
<div class="d-flex align-items-center gap-4 flex-wrap payment-info">
  <div class="payment-item">
    <strong>{{ 'payment.totalPayable' | translate }}</strong> :
    <span class="price-with-symbol">
      <sar-symbol />
      <span>
        {{ bookingDetails.totalPayable | number: '1.2-2' }}
      </span>
    </span>
  </div>
  <div class="payment-item">
    <strong>{{ 'payment.totalPaid' | translate }}</strong> :
    <span class="price-with-symbol">
      <sar-symbol />
      <span>
        {{ bookingDetails.paidAmount | number: '1.2-2' }}
      </span>
    </span>
  </div>
  <div class="payment-item">
    <strong>{{ 'payment.remainingAmount' | translate }}</strong> :
    <span class="price-with-symbol">
      <sar-symbol />
      <span>
        {{ bookingDetails.remainingAmount | number: '1.2-2' }}
      </span>
    </span>
  </div>
</div>

<form appShakeable [formGroup]="form" (ngSubmit)="submit()">
  <!-- Payment/Refund Details Section -->
  <h5>
    {{ 'payment.refund' | translate }}
  </h5>
  <div class="section-container">
    <div class="payment-details">
      <!-- First row with method and amount side by side -->
      <div class="row">
        <div class="payment-method col-md-4">
          <app-dropdown
            [control]="getControl('paymentMethod')"
            [options]="paymentMethods"
            [optionValue]="'id'"
            [optionLabel]="'name'"
            [controlName]="'paymentMethod'"
            [placeholder]="'payment.refundMethod' | translate"
            [label]="'payment.refundMethod' | translate">
            <i class="pi pi-money-bill" style="color: gray"></i>
          </app-dropdown>
        </div>

        <div class="payment-amount col-md-4">
          <app-input
            [control]="getControl('amount')"
            [controlName]="'paidAmount'"
            inputType="number"
            [placeholder]="'payment.refundAmount' | translate"
            [label]="'payment.refundAmount' | translate">
          </app-input>
        </div>

        <div class="date col-md-4">
          <app-date-picker
            [maxDate]="maxDate"
            [inputFieldStyle]="
              lang.lang === 'en' ? {'text-indent': '25px'} : null
            "
            [controlName]="'paymentDate'"
            [label]="'fields.orderDate' | translate"
            [control]="getControl('requestDate')"></app-date-picker>
        </div>
      </div>
    </div>
  </div>

  <!-- Beneficiary Section -->
  <h5 class="section-title">
    {{ 'payment.receiverInfo' | translate }}
  </h5>
  <div class="section-container">
    <div class="beneficiary-section">
      <div class="beneficiary-type d-flex align-items-center mb-4">
        <div class="radio-option d-flex align-items-center">
          <p-radioButton
            formControlName="beneficiaryType"
            value="customer"
            inputId="beneficiary-customer">
          </p-radioButton>
          <label for="beneficiary-customer" class="mx-3">
            {{ 'payment.customerHimself' | translate }}
          </label>
        </div>

        <div class="radio-option d-flex align-items-center mx-4">
          <p-radioButton
            formControlName="beneficiaryType"
            value="other"
            inputId="beneficiary-other">
          </p-radioButton>
          <label for="beneficiary-other" class="mx-3">
            {{ 'payment.anotherPerson' | translate }}
          </label>
        </div>
      </div>

      <div class="beneficiary-info row">
        <app-input
          class="col-md-6"
          [control]="getControl('beneficiaryName')"
          [controlName]="'beneficiaryName'"
          inputType="text"
          [placeholder]="'payment.receiverName' | translate"
          [label]="'payment.receiverName' | translate">
        </app-input>

        <app-phone-input
          class="col-md-6"
          [control]="getControl('beneficiaryMobile')"
          [label]="'fields.mobileNo' | translate"
          [placeholder]="'fields.mobileNoPlaceholder' | translate"
          [phoneNumber]="
            paymentId
              ? paymentDetails?.beneficiary_mobile
              : bookingDetails.user.phone
          ">
        </app-phone-input>
      </div>
    </div>
  </div>

  <!-- Payment Method Section -->
  <app-client-payment-methods [form]="$any(form.get('clientPaymentMethod'))">
  </app-client-payment-methods>

  <!-- Notes Section (at the end) -->
  <h5 class="section-title">{{ 'payment.notes' | translate }}</h5>
  <div class="section-container">
    <div class="notes-section">
      <app-input
        [control]="getControl('notes')"
        [controlName]="'notes'"
        inputType="textarea"
        [placeholder]="'payment.notes' | translate">
      </app-input>
    </div>
  </div>

  <!-- Form Actions -->
  <div class="actions">
    <p-button severity="secondary" class="cancel" (click)="navigateBack()">
      <i class="pi pi-times"></i> {{ 'common.cancel' | translate }}
    </p-button>

    <p-button
      class="save"
      label="{{ 'common.save' | translate }}"
      type="submit"
      [icon]="'pi pi-save'">
    </p-button>
  </div>
</form>
